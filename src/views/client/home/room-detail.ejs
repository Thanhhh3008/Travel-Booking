<%- include('../layout/header.ejs') %>
 <link rel="stylesheet" href="/style-roomdetail.css">
<main class="container section page-room-detail">
  <!-- Th√¥ng b√°o flash -->
  <% if (message) { %>
  <div class="alert <%= message.type %>">
    <span class="alert-icon">
      <%= message.type === 'success' ? '‚úÖ' : '‚ö†Ô∏è' %>
    </span>
    <span class="alert-text"><%= message.mess %></span>
    <button class="alert-close" onclick="this.parentElement.style.display='none';">&times;</button>
  </div>
  <% } %>

  <!-- Room Header -->
  <div class="room-header">
    <div>
      <h1>Ph√≤ng <%= room.TenChoO || 'Ch∆∞a r√µ' %> <%= room.TenLoaiPhong || 'Ch∆∞a r√µ' %> <%= room.SoPhong ? '- Ph√≤ng ' + room.SoPhong : '' %></h1>
      <div class="room-subtitle">
        <% if (room.Rating) { %>
        <span class="rating">‚≠ê <%= room.Rating %></span>
        <span class="divider">¬∑</span>
        <% } %>
        <span><%= room.View || 'Ch∆∞a r√µ' %></span>
        <span class="divider">¬∑</span>
        <span><%= room.ThanhPho || 'Ch∆∞a r√µ' %></span>
      </div>
    </div>
   <div class="room-header-actions">
  <a href="">
    <i class="fa-solid fa-arrow-up-right-from-square"></i> Chia s·∫ª
  </a>

  <a href="">
    <i class="fa-regular fa-heart"></i> L∆∞u
  </a>
</div>

  </div>

  <!-- Room Gallery -->
  <div class="room-gallery">
    <% 
      const images = room.HinhAnh ? room.HinhAnh.split(',') : [];
      const displayImages = images.slice(0, 5);
    %>
    
    <% if (displayImages.length > 0) { %>
      <img src="/admin/uploads/anhphong/<%= displayImages[0].trim() %>" 
           alt="<%= room.TenLoaiPhong %>" 
           class="gallery-main">
      
      <% for(let i = 1; i < displayImages.length && i < 5; i++) { %>
        <img src="/admin/uploads/anhphong/<%= displayImages[i].trim() %>" 
             alt="<%= room.TenLoaiPhong %>">
      <% } %>
    <% } else { %>
      <img src="/admin/uploads/anhphong/default.jpg" 
           alt="Ph√≤ng" 
           class="gallery-main">
    <% } %>
    
    <% if (images.length > 5) { %>
    <button class="show-all-photos" onclick="alert('M·ªü th∆∞ vi·ªán ·∫£nh ƒë·∫ßy ƒë·ªß')">
      <span>‚äû</span> Hi·ªÉn th·ªã t·∫•t c·∫£ ·∫£nh
    </button>
    <% } %>
  </div>

  <!-- Room Content -->
  <div class="room-content">
    <!-- Left side - Room info -->
    <div class="room-info-section">
      <!-- Title Section -->
      <div class="room-title-section">
        <h2>To√†n b·ªô nh√† ngh·ªâ <%= room.TenChoO || 'Ch∆∞a r√µ' %>  t·∫°i <%= room.DiaChi ? room.DiaChi.split(',')[0] : 'Li√™n S∆°n' %>, Vi·ªát Nam</h2>
        <div class="room-meta-inline">
          <span>3 kh√°ch</span>
          <span>1 ph√≤ng ng·ªß</span>
          <span>1 gi∆∞·ªùng</span>
          <span>1 ph√≤ng t·∫Øm</span>
        </div>
      </div>

      <!-- Host Section -->
      <div class="host-section">
        <img
  src="<%= room.avartar ? '/avartar/' + room.avartar : '/avartar/avartar-mac-dinh.png' %>"
  alt="Host"
  class="host-avatar"
>
        <div class="host-info">
          <h3>Host: <%= room.Username || 'Ch∆∞a r√µ' %></h3>
          <p class="host-meta">11 nƒÉm l√†m host tr√™n TripStay</p>
        </div>
      </div>

      <!-- Description -->
      <% if (room.MoTa || room.description) { %>
      <div class="room-desc-block">
        <p><%= room.MoTa || room.description %></p>
        <button class="show-more-btn" onclick="alert('Hi·ªÉn th·ªã th√™m m√¥ t·∫£')">Hi·ªÉn th·ªã th√™m ></button>
      </div>
      <% } %>

      <!-- Amenities -->
     <!-- Amenities -->
<div class="amenities-section">
  <h3>N∆°i n√†y c√≥ nh·ªØng g√¨ cho b·∫°n</h3>

  <div class="amenities-grid">

    <div class="amenity-item">
      <i class="fa-solid fa-kitchen-set amenity-icon"></i>
      <span class="amenity-text">B·∫øp</span>
    </div>

    <div class="amenity-item">
      <i class="fa-solid fa-wifi amenity-icon"></i>
      <span class="amenity-text">Wi-fi</span>
    </div>

    <div class="amenity-item">
      <i class="fa-solid fa-briefcase amenity-icon"></i>
      <span class="amenity-text">Kh√¥ng gian ri√™ng ƒë·ªÉ l√†m vi·ªác</span>
    </div>

    <div class="amenity-item">
      <i class="fa-solid fa-car amenity-icon"></i>
      <span class="amenity-text">Ch·ªó ƒë·ªó xe mi·ªÖn ph√≠ t·∫°i n∆°i ·ªü</span>
    </div>

    <div class="amenity-item">
      <i class="fa-solid fa-person-swimming amenity-icon"></i>
      <span class="amenity-text">B·ªÉ b∆°i</span>
    </div>

    <div class="amenity-item">
      <i class="fa-solid fa-hot-tub-person amenity-icon"></i>
      <span class="amenity-text">B·ªìn t·∫Øm n∆∞·ªõc n√≥ng</span>
    </div>

    <div class="amenity-item">
      <i class="fa-solid fa-dog amenity-icon"></i>
      <span class="amenity-text">Cho ph√©p th√∫ c∆∞ng</span>
    </div>

    <div class="amenity-item">
      <i class="fa-solid fa-video amenity-icon"></i>
      <span class="amenity-text">Camera an ninh ngo√†i nh√†</span>
    </div>

    <div class="amenity-item amenity-unavailable">
      <i class="fa-solid fa-ban amenity-icon"></i>
      <span class="amenity-text">M√°y ph√°t hi·ªán kh√≠ CO</span>
    </div>

    <div class="amenity-item amenity-unavailable">
      <i class="fa-solid fa-ban amenity-icon"></i>
      <span class="amenity-text">Cho ph√©p thu·ªëc l√°</span>
    </div>

  </div>
</div>


      <!-- Reviews -->
<div class="reviews-section">

  <!-- Header -->
  <div class="reviews-header">
    <h3>
      ‚≠ê <%= room.Rating ? Number(room.Rating).toFixed(1) : 'Ch∆∞a c√≥' %>
    </h3>
    <span>¬∑ <%= reviews.length %> ƒë√°nh gi√°</span>
  </div>

  <!-- Review Form -->
  <div class="room-desc-block">
    <h3>ƒê√°nh gi√°</h3>

    <% if (!currentUser) { %>
      <!-- Ch∆∞a ƒëƒÉng nh·∫≠p -->
      <p style="color:#717171;">
        Vui l√≤ng <a href="/login.html">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ vi·∫øt ƒë√°nh gi√°.
      </p>

    <% } else if (!canReview) { %>
      <!-- Kh√¥ng ƒë·ªß ƒëi·ªÅu ki·ªán -->
      <p style="color:#717171;">
        B·∫°n ch·ªâ c√≥ th·ªÉ ƒë√°nh gi√° sau khi ƒë√£ ho√†n th√†nh k·ª≥ ngh·ªâ t·∫°i ph√≤ng n√†y.
  
      </p>

    <% } else { %>
      <!-- ƒê∆Ø·ª¢C PH√âP ƒê√ÅNH GI√Å -->
      <form action="/rooms/<%= room.MaPhong || room.id %>/review"  method="post" class="review-form">

        <input type="hidden" name="roomId" value="<%= room.MaPhong || room.id %>">

        <!-- Rating -->
        <div class="form-group">
          <label>ƒê√°nh gi√° c·ªßa b·∫°n</label>
          <div class="star-rating">
            <% for (let i = 5; i >= 1; i--) { %>
              <input
                type="radio"
                id="star-<%= i %>"
                name="rate"
                value="<%= i %>"
                required
              >
              <label for="star-<%= i %>">‚òÖ</label>
            <% } %>
          </div>
        </div>

        <!-- Content -->
        <div class="form-group">
          <label>N·ªôi dung ƒë√°nh gi√°</label>
          <textarea
          name="content"
          rows="4"
          placeholder="H√£y chia s·∫ª tr·∫£i nghi·ªám c·ªßa b·∫°n (t·ªëi ƒëa 200 k√Ω t·ª±)..."
          required
          id="reviewContent"
          maxlength="200"
        ></textarea>

<small id="charCount" style="color:#717171;">
  0 / 200 k√Ω t·ª±
</small>


        </div>

        <button type="submit" class="btn primary">
          G·ª≠i ƒë√°nh gi√°
        </button>
      </form>
    <% } %>
  </div>

  <!-- Review List -->
  <div class="reviews-grid">


    <% if (reviews.length === 0) { %>
      <p style="color:#717171;">Ch∆∞a c√≥ ƒë√°nh gi√° n√†o cho ph√≤ng n√†y.</p>
    <% } %>

    <% reviews.forEach((review, index) => { %>
      <div class="review-item <%= index >= 4 ? 'hidden-review' : '' %>">


        <div class="review-header">
          <div class="reviewer-avatar">
  <img
    src="<%= review.avartar 
          ? '/avartar/' + review.avartar 
          : '/avartar/avartar-mac-dinh.png' %>"
    alt="<%= review.HoTen || 'Ng∆∞·ªùi d√πng' %>"
    onerror="this.src='/avartar/avartar-mac-dinh.png'"
  >
</div>


          <div class="reviewer-info">
            <h4><%= review.HoTen || 'Ng∆∞·ªùi d√πng' %></h4>
            <p class="reviewer-meta">
              <%= new Date(review.NgayDanhGia).toLocaleDateString('vi-VN') %>
            </p>
          </div>
        </div>

        <div class="review-rating">
  <span class="stars">
    <% for (let i = 1; i <= review.SoSao; i++) { %>‚òÖ<% } %>
    <% for (let i = review.SoSao + 1; i <= 5; i++) { %>‚òÜ<% } %>
  </span>
  <span class="rating-number">
    <%= review.SoSao %>.0 / 5
  </span>
</div>


        <p class="review-text clamp">
          <%= review.NoiDung %>
        </p>

        <% if (review.NoiDung.length > 120) { %>
          <button class="review-more-btn">Xem th√™m</button>
        <% } %>


      </div>
    <% }) %>

  </div>
    <% if (reviews.length > 4) { %>
  <div style="margin-top: 16px;">
    <button id="showMoreReviews" class="btn">
      Xem th√™m ƒë√°nh gi√°
    </button>
  </div>
<% } %>
</div>

      <!-- Host Profile -->
      <div class="room-desc-block">
        <h3>G·∫∑p g·ª° host c·ªßa b·∫°n</h3>
        <div class="host-section">
          <img
  src="<%= room.avartar ? '/avartar/' + room.avartar : '/avartar/avartar-mac-dinh.png' %>"
  alt="Host"
  class="host-avatar"
>
          <div class="host-info">
            <h3><%= room.HoTen || 'Ch∆∞a r√µ' %></h3>
            <p class="host-meta">Host</p>
            <div style="margin-top: 12px;">
              <p><strong>11</strong> ƒê√°nh gi√°</p>
              <p><strong>4,82‚òÖ</strong> X·∫øp h·∫°ng</p>
              <p><strong>1</strong> Th√°ng kinh nghi·ªám ƒë√≥n ti·∫øp kh√°ch</p>
            </div>
          </div>
        </div>
        <p style="margin-top: 16px; line-height: 1.6;">
          üìç Sinh ra v√†o th·∫≠p ni√™n 80<br>
          üíº C√¥ng vi·ªác c·ªßa t√¥i: The Moon Villa
        </p>
        <p style="margin-top: 16px; line-height: 1.6;">
          Xin ch√†o, m√¨nh l√† <%= room.HoTen || 'Ch∆∞a r√µ' %> ‚Äì m·ªôt ng∆∞·ªùi y√™u thi√™n nhi√™n, y√™u bi·ªÉn v√† ƒë·∫∑c bi·ªát ƒëam m√™ nh·ªØng ng√¥i nh√† ƒë·∫πp mang h∆°i th·ªü b√¨nh y√™n...
        </p>
        <a class="show-more-btn" href="https://mail.google.com/mail/?view=cm&fs=1
&to=<%= room.Email|| 'Ch∆∞a r√µ' %>" target="_blank">Nh·∫Øn tin cho host</a>
        <!-- <button class="show-more-btn">Nh·∫Øn tin cho host</button> -->
      </div>

      <!-- Additional Info -->
      <div class="room-desc-block">
        <h3>Th√¥ng tin Ch·ªß nh√†</h3>
        <p><strong>T·ªâ l·ªá ph·∫£n h·ªìi:</strong> 100%</p>
        <p><strong>Ph·∫£n h·ªìi trong v√≤ng:</strong> 1 gi·ªù</p>
        <a class="show-more-btn" href="https://mail.google.com/mail/?view=cm&fs=1
&to=<%= room.Email|| 'Ch∆∞a r√µ' %>">Nh·∫Øn tin cho host</a>
        <p style="font-size: 12px; color: #717171; margin-top: 24px;">
          üõ°Ô∏è ƒê·ªÉ b·∫£o v·ªá kho·∫£n thanh to√°n c·ªßa b·∫°n, h√£y lu√¥n s·ª≠ d·ª•ng TripStay ƒë·ªÉ chuy·ªÉn ti·ªÅn v√† li√™n l·∫°c v·ªõi host.
        </p>
      </div>
    </div>

    <!-- Right side - Booking card -->
    <div class="booking-card">
      <div class="booking-price">
        <span class="price"><%= helpers.formatMoney(room.Gia || room.price) %></span>
        <span class="per-night">/ƒë√™m</span>
      </div>

     
 <!-- N√∫t ƒë·∫∑t ph√≤ng -->
            <div class="room-actions">
                <a href="/rooms/<%= room.MaPhong || room.id %>/book"
                    class="btn primary">
                    ƒê·∫∑t ph√≤ng ngay
                </a>
                <a href="/" class="btn">Quay l·∫°i trang ch·ªß</a>
            </div>
    </div>
  </div>
</main>
<script>
  const textarea = document.getElementById('reviewContent');
  const counter = document.getElementById('charCount');

  textarea.addEventListener('input', () => {
    const length = textarea.value.length;

    if (length > 200) {
      textarea.value = textarea.value.slice(0, 200);
    }

    counter.textContent = `${textarea.value.length} / 200 k√Ω t·ª±`;
  });
  
</script>
<script>
  const showMoreBtn = document.getElementById('showMoreReviews');

  if (showMoreBtn) {
    showMoreBtn.addEventListener('click', () => {
      document.querySelectorAll('.hidden-review')
        .forEach(el => el.style.display = 'block');

      showMoreBtn.style.display = 'none';
    });
  }
</script>

<script>
  document.querySelectorAll('.review-more-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const text = btn.previousElementSibling;

      text.classList.toggle('clamp');

      btn.textContent = text.classList.contains('clamp')
        ? 'Xem th√™m'
        : 'Thu g·ªçn';
    });
  });
</script>

<%- include('../layout/footer.ejs') %>