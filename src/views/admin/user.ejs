<%- include('./layout/header') %>

<div class="container mt-4">

  <!-- Tiêu đề + Thanh tìm kiếm -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="fw-bold">
      <i class="fa-solid fa-users text-primary me-1"></i>
      Quản lý Người dùng
    </h3>

    <!-- Thanh tìm kiếm -->
    <form action="/admin/user" method="get" class="d-flex align-items-center gap-2 search-bar">
      <input 
        type="text" 
        name="search" 
        class="form-control form-control-sm search-input" 
        placeholder="Nhập username, họ tên, SĐT hoặc email..." 
        value="<%= search || '' %>"
      >

      <button type="submit" class="btn btn-primary btn-sm" title="Tìm kiếm">
        <i class="fa-solid fa-magnifying-glass"></i>
      </button>

      <% if (search) { %>
        <a href="/admin/user" class="btn btn-secondary btn-sm" title="Xóa bộ lọc">
          <i class="fa-solid fa-xmark"></i>
        </a>
      <% } %>
    </form>
  </div>

  <!-- Bảng danh sách người dùng -->
  <div class="table-responsive shadow-sm rounded-3">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-primary">
        <tr>
          <th>#</th>
          <th>Username</th>
          <th>Họ tên</th>
          <th>Email</th>
          <th>SĐT</th>
          <th class="text-center">Thao tác</th>
        </tr>
      </thead>
      <tbody>
        <% if (users && users.length > 0) { %>
          <% users.forEach(u => { %>
            <tr>
              <td><%= u.MaNguoiDung %></td>
              <td><%= u.Username %></td>
              <td><%= u.HoTen %></td>
              <td><%= u.Email || '' %></td>
              <td><%= u.SDT || '' %></td>
              <td class="text-center">
              <a 
                href="/admin/user/detail/<%= u.MaNguoiDung %>" 
                class="btn btn-outline-primary btn-sm"
                title="Xem chi tiết"
              >
                <i class="fa-solid fa-eye"></i>
                Xem
              </a>

              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="6" class="text-center text-muted py-4">
              <i class="fa-solid fa-user-slash me-1"></i>
              Không có người dùng nào.
            </td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>

</div>

<!-- CSS -->
<style>
  .search-bar {
    max-width: 380px;
  }

  .search-input {
    width: 240px;
    height: 34px;
    font-size: 14px;
  }

  .btn-sm {
    padding: 5px 10px;
    font-size: 13px;
  }
</style>

<!-- Alert xóa -->
<script>
  const params = new URLSearchParams(window.location.search);
  if (params.get('deleted') === '1') {
    alert(' Xóa người dùng thành công! Tất cả các phòng và thông báo liên quan sẽ bị xóa!');
    window.history.replaceState({}, document.title, window.location.pathname);
  }
</script>

<%- include('./layout/footer') %>
