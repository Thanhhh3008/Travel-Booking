<%- include('./layout/header') %>

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
  <h3>
  <i class="fa-solid fa-receipt me-2 text-primary"></i>
  Danh sách chi tiết đặt phòng
</h3>

    <div class="badge bg-info fs-6">
      <i class="fa-solid fa-receipt"></i>
      <%= totalBookings %> đơn
    </div>
    <!-- Bộ lọc trạng thái đặt phòng -->
<div class="d-flex justify-content-end mb-3">
  <form method="GET" action="/admin/datphong" class="filter-form d-flex gap-2 align-items-center">
    
    <select name="status" class="form-select filter-select" onchange="this.form.submit()">
      <option value="">Tất cả trạng thái</option>
      <option value="0" <%= status === '0' ? 'selected' : '' %>>
        Chưa hoàn thành
      </option>
      <option value="1" <%= status === '1' ? 'selected' : '' %>>
        Đã hoàn thành
      </option>
    </select>

    <a href="/admin/datphong" class="btn btn-outline-secondary filter-reset">
      <i class="fa-solid fa-rotate-left"></i>
    </a>

  </form>
</div>

  </div>

  <div class="table-container">
    <table class="table table-striped table-hover mb-0">
      <thead class="table-light">
  <tr>
    <th>#</th>
    <th>Username</th>
    <th>Tên chỗ ở</th>
    <th>Ngày đặt</th>
    <th>Ngày nhận phòng</th>
    <th>Ngày trả phòng</th>
    <th>Trạng thái</th>
    <th>Thao tác</th>
  </tr>
</thead>
<tbody>
  <% if (bookings.length > 0) { %>
    <% bookings.forEach(b => { %>
      <tr>
        <td><%= b.MaChiTietDatPhong %></td>
        <td><%= b.Username %></td>
        <td><%= b.TenChoO %></td>
        <td><%= new Date(b.NgayDatPhong).toLocaleDateString('vi-VN') %></td>
        <td><%= b.NgayNhanPhong ? new Date(b.NgayNhanPhong).toLocaleDateString('vi-VN') : '-' %></td>
        <td><%= b.NgayTraPhong ? new Date(b.NgayTraPhong).toLocaleDateString('vi-VN') : '-' %></td>
        <td style="width: 180px; text-align: center;">
          <% if (b.TrangThai == 1) { %>
            <span class="badge bg-success w-100 d-inline-block">
              <i class="fa-solid fa-check"></i> Đã hoàn thành
            </span>
          <% } else { %>
            <span class="badge bg-warning text-dark w-100 d-inline-block">
              <i class="fa-solid fa-clock"></i> Chưa hoàn thành
            </span>
          <% } %>
        </td>
        <td>
          <a href="/admin/datphong/<%= b.MaChiTietDatPhong %>/print" 
             class="btn btn-secondary btn-sm" target="_blank">
            <i class="fa-solid fa-print"></i> In hóa đơn
          </a>
        </td>
      </tr>
    <% }) %>
  <% } else { %>
    <tr>
      <td colspan="8" class="text-center text-muted py-5">
        <i class="fa-solid fa-inbox fa-3x mb-3 d-block"></i>
        Không có dữ liệu
      </td>
    </tr>
  <% } %>
</tbody>

    </table>
  </div>

  <!-- PHÂN TRANG -->
  <% if (totalPages > 1) { %>
  <div class="pagination-wrapper">
    <div class="page-info">
      Hiển thị <%= (currentPage - 1) * limit + 1 %> -
      <%= Math.min(currentPage * limit, totalBookings) %>
      / <%= totalBookings %> đơn
    </div>

    <nav>
      <ul class="pagination mb-0">

        <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
          <a class="page-link" href="?page=<%= currentPage - 1 %>">
            <i class="fa-solid fa-chevron-left"></i>
          </a>
        </li>

        <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
          <li class="page-item <%= i === currentPage ? 'active' : '' %>">
            <a class="page-link" href="?page=<%= i %>"><%= i %></a>
          </li>
        <% } %>

        <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
          <a class="page-link" href="?page=<%= currentPage + 1 %>">
            <i class="fa-solid fa-chevron-right"></i>
          </a>
        </li>

      </ul>
    </nav>
  </div>
  <% } %>
</div>

<%- include('./layout/footer') %>
