<%- include('./layout/header') %>

<style>
  /* Pagination styles */
  .pagination-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 2rem;
    gap: 1rem;
  }

  .pagination {
    margin: 0;
  }

  .pagination .page-link {
    border-radius: 8px;
    margin: 0 4px;
    padding: 8px 14px;
    color: #0d6efd;
    border: 1px solid #dee2e6;
    transition: all 0.2s ease;
  }

  .pagination .page-link:hover {
    background-color: #e7f1ff;
    border-color: #0d6efd;
  }

  .pagination .page-item.active .page-link {
    background-color: #e7f1ff;
    border-color: #0d6efd;
    font-weight: 600;
  }

  .pagination .page-item.disabled .page-link {
    color: #6c757d;
    background-color: #f8f9fa;
    cursor: not-allowed;
  }

  .page-info {
    color: #6c757d;
    font-size: 14px;
  }

  .table-container {
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    overflow: hidden;
  }
</style>

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3>üìã Danh s√°ch ch·ªó ·ªü ch·ªù duy·ªát</h3>
    <div class="badge bg-warning text-dark fs-6">
      <i class="fa-solid fa-clock"></i> <%= totalRooms %> ph√≤ng ch·ªù duy·ªát
    </div>
  </div>

  <div class="table-container">
    <table class="table table-striped table-hover mb-0">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>S·ªë ph√≤ng</th>
          <th>T√™n ch·ªó ·ªü</th>
          <th>T·ªânh/Th√†nh ph·ªë</th>
          <th>Ng∆∞·ªùi ƒëƒÉng</th>
          <th>Tr·∫°ng th√°i</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        <% if (rooms && rooms.length > 0) { %>
          <% rooms.forEach((room, index) => { %>
            <tr>
              <td><%= room.MaPhong %></td>
              <td><%= room.SoPhong %></td>
              <td><%= room.TenChoO %></td>
              <td><%= room.ProvinceName || 'Kh√¥ng x√°c ƒë·ªãnh' %></td>
              <td><%= room.Username || 'Kh√¥ng x√°c ƒë·ªãnh' %></td>
              <td>
                <span class="badge bg-secondary">
                  <i class="fa-solid fa-hourglass-half"></i> <%= room.TrangThaiPhong %>
                </span>
              </td>
              <td>
                <a href="/admin/duyetphong/<%= room.MaPhong %>" 
                   class="btn btn-info btn-sm"
                   title="Xem chi ti·∫øt v√† duy·ªát">
                  <i class="fa-solid fa-eye"></i> Xem chi ti·∫øt
                </a>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="7" class="text-center text-muted py-5">
              <i class="fa-solid fa-inbox fa-3x mb-3 d-block text-secondary"></i>
              <p class="mb-0">Kh√¥ng c√≥ ph√≤ng n√†o ch·ªù duy·ªát.</p>
            </td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>

  <!-- Ph√¢n trang -->
  <% if (totalPages > 1) { %>
  <div class="pagination-wrapper">
    <div class="page-info">
      Hi·ªÉn th·ªã <%= (currentPage - 1) * limit + 1 %> - <%= Math.min(currentPage * limit, totalRooms) %> 
      trong t·ªïng s·ªë <%= totalRooms %> ph√≤ng
    </div>
    
    <nav aria-label="Ph√¢n trang">
      <ul class="pagination mb-0">
        <!-- N√∫t Previous -->
        <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
          <a class="page-link" href="?page=<%= currentPage - 1 %>" 
             aria-label="Trang tr∆∞·ªõc">
            <i class="fa-solid fa-chevron-left"></i>
          </a>
        </li>

        <!-- Trang ƒë·∫ßu -->
        <% if (currentPage > 3) { %>
          <li class="page-item">
            <a class="page-link" href="?page=1">1</a>
          </li>
          <% if (currentPage > 4) { %>
            <li class="page-item disabled">
              <span class="page-link">...</span>
            </li>
          <% } %>
        <% } %>

        <!-- C√°c trang xung quanh trang hi·ªán t·∫°i -->
        <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
          <li class="page-item <%= i === currentPage ? 'active' : '' %>">
            <a class="page-link" href="?page=<%= i %>">
              <%= i %>
            </a>
          </li>
        <% } %>

        <!-- Trang cu·ªëi -->
        <% if (currentPage < totalPages - 2) { %>
          <% if (currentPage < totalPages - 3) { %>
            <li class="page-item disabled">
              <span class="page-link">...</span>
            </li>
          <% } %>
          <li class="page-item">
            <a class="page-link" href="?page=<%= totalPages %>">
              <%= totalPages %>
            </a>
          </li>
        <% } %>

        <!-- N√∫t Next -->
        <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
          <a class="page-link" href="?page=<%= currentPage + 1 %>" 
             aria-label="Trang sau">
            <i class="fa-solid fa-chevron-right"></i>
          </a>
        </li>
      </ul>
    </nav>
  </div>
  <% } %>

</div>

<script>
  const params = new URLSearchParams(window.location.search);

  if (params.get('approved') === '1') {
    alert('Ph√™ duy·ªát ph√≤ng th√†nh c√¥ng!');
    window.history.replaceState({}, document.title, window.location.pathname);
  } 
  else if (params.get('rejected') === '1') {
    alert(' Ph√≤ng ƒë√£ b·ªã t·ª´ ch·ªëi th√†nh c√¥ng!');
    window.history.replaceState({}, document.title, window.location.pathname);
  } 
  else if (params.get('error') === '1') {
    alert(' C√≥ l·ªói x·∫£y ra khi x·ª≠ l√Ω y√™u c·∫ßu!');
    window.history.replaceState({}, document.title, window.location.pathname);
  }
</script>

<%- include('./layout/footer') %>