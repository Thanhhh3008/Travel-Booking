<%- include('./layout/header') %>
<style>
  /* Bộ lọc trạng thái */
.filter-form {
  background: #ffffff;
  padding: 8px 12px;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

.filter-select {
  min-width: 220px;
  border-radius: 8px;
  font-size: 14px;
}

.filter-select:focus {
  border-color: #0d6efd;
  box-shadow: 0 0 0 0.15rem rgba(13, 110, 253, 0.25);
}

.filter-reset {
  border-radius: 8px;
  padding: 6px 12px;
  transition: all 0.2s ease;
}

.filter-reset:hover {
  background-color: #f8f9fa;
  color: #000;
}

</style>
<div class="container mt-4">
  <h3 class="fw-bold mb-4">Danh sách tất cả chỗ ở</h3>

<!-- Bộ lọc -->
<div class="d-flex justify-content-end mb-3">
  <form method="GET" action="/admin/duyetphong/tatca" class="filter-form d-flex gap-2 align-items-center">
    
    <select name="status" class="form-select filter-select" onchange="this.form.submit()">
      <option value="">Tất cả trạng thái</option>
      <option value="Chờ xét duyệt" <%= status === 'Chờ xét duyệt' ? 'selected' : '' %>>
        Chờ xét duyệt
      </option>
      <option value="Đang hoạt động" <%= status === 'Đang hoạt động' ? 'selected' : '' %>>
        Đang hoạt động
      </option>
      <option value="Đã từ chối" <%= status === 'Đã từ chối' ? 'selected' : '' %>>
        Đã từ chối
      </option>
    </select>

    <a href="/admin/duyetphong/tatca" class="btn btn-outline-secondary filter-reset">
      <i class="fa-solid fa-rotate-left"></i>
    </a>

  </form>
</div>

  <div class="table-responsive shadow-sm rounded-3">
    <table class="table table-hover align-middle">
  <thead class="table-primary text-center">
    <tr>
      <th>#</th>
      <th>Số phòng</th>
      <th>Địa chỉ</th>
      <th>Thành phố</th>
      <th>Loại phòng</th>
      <th>Chủ sở hữu</th>
      <th>Trạng thái</th>
      <th>Thao tác</th>
    </tr>
  </thead>

  <tbody>
    <% if (rooms && rooms.length > 0) { %>
      <% rooms.forEach(room => { %>
        <tr>
          <td class="text-center"><%= room.MaPhong %></td>

          <td><%= room.SoPhong %></td>

          <td><%= room.DiaChi %></td>

          <td><%= room.ThanhPho || "Không rõ" %></td>

          <td><%= room.TenLoaiPhong || "Không rõ" %></td>

          <td><%= room.Username || "Không rõ" %></td>

          <td>
            <% if (room.TrangThaiPhong === 'Chờ xét duyệt') { %>
              <span class="badge bg-secondary">Chờ xét duyệt</span>
            <% } else if (room.TrangThaiPhong === 'Đang hoạt động') { %>
              <span class="badge bg-success">Đang hoạt động</span>
            <% } else if (room.TrangThaiPhong === 'Đã từ chối') { %>
              <span class="badge bg-danger">Đã từ chối</span>
            <% } else { %>
              <span class="badge bg-warning text-dark">
                <%= room.TrangThaiPhong %>
              </span>
            <% } %>
          </td>

          <td class="text-center">
            <!-- Xem chi tiết -->
            <a href="/admin/duyetphong/<%= room.MaPhong %>" 
               class="btn btn-sm btn-outline-primary" 
               title="Xem chi tiết">
              <i class="fa-solid fa-eye"></i> Xem
            </a>

            <!-- Xóa -->
            <form action="/admin/duyetphong/xoaphong/<%= room.MaPhong %>" 
                  method="POST" 
                  style="display:inline;">
              <button type="submit" 
                      class="btn btn-sm btn-outline-danger"
                      title="Xóa phòng"
                      onclick="return confirm('Bạn có chắc muốn xóa phòng này không?');">
                <i class="fa-solid fa-trash"></i> Xóa
              </button>
            </form>
          </td>
        </tr>
      <% }) %>
    <% } else { %>
      <tr>
        <td colspan="8" class="text-center text-muted py-4">
          Không có chỗ ở nào trong hệ thống.
        </td>
      </tr>
    <% } %>
  </tbody>
</table>

  </div>
</div>
<script>
  const params = new URLSearchParams(window.location.search);
  if (params.get('deleted') === '1') {
    alert(' Xóa phòng thành công!');
    // Xóa query khỏi URL để không hiện lại khi refresh
    window.history.replaceState({}, document.title, window.location.pathname);
  }
</script>

<%- include('./layout/footer') %>


